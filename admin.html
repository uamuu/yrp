<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Admin - ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { border-collapse: collapse; width: 100%; margin-bottom: 30px; }
    th, td { border: 1px solid #ccc; padding: 8px; }
    th { background-color: #f2f2f2; }
    .summary, .graph { margin-top: 20px; }
  </style>
</head>
<body>

  <script>
    const password = prompt("üîê ‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô:");
    if (password !== "admin123") {
      document.body.innerHTML = "<h2>‚õî ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á</h2>";
      throw new Error("Unauthorized");
    }
  </script>

  <h2>üìã ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏±‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£</h2>
  <table id="orderTable">
    <thead>
      <tr>
        <th>‡πÄ‡∏ß‡∏•‡∏≤</th><th>‡πÇ‡∏ï‡πä‡∏∞</th><th>‡πÄ‡∏°‡∏ô‡∏π</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô</th><th>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="summary">
    <h3>üìå ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
    <ul id="menuSummary"></ul>
  </div>

  <div class="graph">
    <h3>üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡πÄ‡∏°‡∏ô‡∏π (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)</h3>
    <canvas id="menuChart" height="100"></canvas>
  </div>

  <script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbzmQHn267kLfORwy8sFDFBjdDJt-AznaI7oy5MRCeg/dev'; // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL

    fetch(scriptURL)
      .then(res => res.json())
      .then(data => {
        const tbody = document.querySelector("#orderTable tbody");
        const summary = {};
        const today = new Date().toDateString();

        data.slice(1).forEach(row => {
          const [timestamp, table, menu, qty, note] = row;
          const date = new Date(timestamp).toDateString();

          // ‡πÉ‡∏™‡πà‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á
          const tr = document.createElement("tr");
          tr.innerHTML = `<td>${timestamp}</td><td>${table}</td><td>${menu}</td><td>${qty}</td><td>${note}</td>`;
          tbody.appendChild(tr);

          // ‡∏ô‡∏±‡∏ö‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
          if (date === today) {
            summary[menu] = (summary[menu] || 0) + Number(qty);
          }
        });

        // ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°
        const ul = document.getElementById("menuSummary");
        const labels = [], values = [];

        for (let menu in summary) {
          labels.push(menu);
          values.push(summary[menu]);
          const li = document.createElement("li");
          li.textContent = `${menu}: ${summary[menu]} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
          ul.appendChild(li);
        }

        // ‡∏Å‡∏£‡∏≤‡∏ü Chart.js
        const ctx = document.getElementById('menuChart');
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: '‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)',
              data: values,
              backgroundColor: 'rgba(75, 192, 192, 0.6)'
            }]
          },
          options: {
            responsive: true,
            scales: {
              y: { beginAtZero: true }
            }
          }
        });
      });
  </script>
</body>
</html>
